<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SQL Injection Insert - RootMe Solutions &amp; Write-Ups</title>


        <!-- Custom HTML head -->

        <meta name="description" content="RootMe Solutions &amp; Write-Ups for education purposes.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../../css/variables-0f4f7d13.css">
        <link rel="stylesheet" href="../../css/general-d4e31f58.css">
        <link rel="stylesheet" href="../../css/chrome-49e8d624.css">
        <link rel="stylesheet" href="../../css/print-ad67d350.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome-799aeb25.css">
        <link rel="stylesheet" href="../../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight-493f70e1.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc-edbf2422.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">RootMe Solutions &amp; Write-Ups</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nh4ttruong/emtoor" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="write-up"><a class="header" href="#write-up">WRITE UP</a></h1>
<p><strong>Challenge:</strong> <a href="https://www.root-me.org/en/Challenges/Web-Server/SQL-injection-Insert">SQL injection - Insert</a></p>
<img src="./media/image1.png" style="width:6.5in;height:2.09028in" alt="Graphical user interface, text, application Description automatically generated" />
<p>Website cho ta 2 tab gồm authentication và register. Ở Register, ta có thể tùy ý tạo được account và không hề có filter input.</p>
<img src="./media/image2.png" style="width:5.95544in;height:1.93615in" alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image3.png" style="width:5.98037in;height:2.43987in" alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image4.png" style="width:6.5in;height:1.90208in" alt="Graphical user interface, text, application, website Description automatically generated" />
<p>Từ đó, ta xác định chỗ để tiêm vào database. Ở tab register, ta có thể thấy website yêu câu 3 field gồm username, password và email. Do đó, database sẽ thực hiện tạo user theo kiểu:</p>
<p><em><strong>INSERT INTO users VALUES (username, password, email)</strong></em></p>
<p>Trong khi đó, website không hề filter email field và ta có thể lợi dụng bug này để có thể INSERT thêm các giá trị ta muốn với multiple insertions và tấn công vào email field.</p>
<p><strong>Payload:</strong> <em>INSERT INTO users VALUES (username, password, email), (sth, sth, attack_payload)-- -</em></p>
<img src="./media/image5.png" style="width:6.5in;height:3.27292in" alt="Graphical user interface, text, application Description automatically generated" />
<p>Login vào account, <em><strong>ss, ss, (select version()):</strong></em></p>
<img src="./media/image6.png" style="width:6.5in;height:3.23264in" alt="Graphical user interface, text, application, email Description automatically generated" />
<ul>
<li>Database version(): <strong>10.3.34-MariaDB-0ubuntu0.20.04.1</strong></li>
</ul>
<p>Tiếp tục, ta cần fuzz để tìm ra được table và column, nhưng khi thử thì bị message “Request failed” cho đến khi sử dụng LIMIT thì mới biết là nó bị giới hạn:</p>
<img src="./media/image7.png" style="width:6.5in;height:3.16458in" alt="Graphical user interface, text, application, email Description automatically generated" />
<p>Thử sử dụng trick với OFFSET thì được response <strong>“Attack detected”.</strong></p>
<img src="./media/image8.png" style="width:6.5in;height:3.20139in" alt="Graphical user interface, text, application, email Description automatically generated" />
<p>Login vào account vừa INSERT, ta biết được 1 table:</p>
<img src="./media/image9.png" style="width:6.5in;height:2.57778in" alt="Graphical user interface, text Description automatically generated" />
<p>Sử dụng GROUP_CONCAT để show các table nhưng có vẻ không có tables nào có thông tin user hoặc flag mà toàn là các table khác.:</p>
<img src="./media/image10.png" style="width:6.5in;height:2.48125in" alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image11.png" style="width:6.5in;height:3.03889in" alt="Graphical user interface, text, application, email Description automatically generated" />
<p>Thử xem lại version, ta thấy server sử dụng MariaDB. Sau một hồi stuck và check cheatsheet, ta có thể sử dụng <strong>information_schema.processlist</strong> để check các thread đang thực thi của server database (vì user có thể reg bất cứ lúc nào). Lúc này, ta có thể kiểm tra table <strong>INFO</strong> để có thể xem server sẽ thực thi cái gì khi reg account (<a href="https://mariadb.com/kb/en/information-schema-processlist-table/">Information Schema PROCESSLIST Table - MariaDB Knowledge Base</a>):</p>
<img src="./media/image12.png" style="width:5.99323in;height:2.98848in" alt="Graphical user interface, text, application, email Description automatically generated" />
<p>Reg acc để show table <strong>INFO</strong> của <strong>information_schema.processlist</strong>:</p>
<img src="./media/image13.png" style="width:6.32601in;height:2.75749in" alt="Graphical user interface, text Description automatically generated" />
<img src="./media/image14.png" style="width:6.37083in;height:2.61121in" alt="Graphical user interface, text, application, email Description automatically generated" />
<p>Payload thực thi của server:</p>
<p><em><strong>INSERT INTO `membres` ( `username`, `password`, `email`)</strong></em></p>
<ul>
<li>Table cần tìm: <strong>membres</strong></li>
</ul>
<p>Show các column của membres table:</p>
<img src="./media/image15.png" style="width:6.5in;height:2.81597in" alt="Graphical user interface, text, email Description automatically generated" />
<p>Tuy vậy, ta chẳng kiếm được bất kỳ thông tin nào từ bảng membres này cả</p>
<p>Sau 2 tiếng stuck, vì quá bất lực, em quyết định sử dụng burpsuite để bruteforce tất cả các table của <strong>information_schema.tables:</strong></p>
<ul>
<li>Auto register account:</li>
</ul>
<img src="./media/image16.png" style="width:6.5in;height:3.27083in" alt="Graphical user interface, application Description automatically generated" />
<ul>
<li>Auto login:</li>
</ul>
<img src="./media/image17.png" style="width:6.5in;height:3.64375in" alt="Graphical user interface, application Description automatically generated" />
<ul>
<li>Sau khi xem qua các table mà bruteforce giúp ta leak, ta đã tìm được đúng table cần tìm :</li>
</ul>
<img src="./media/image18.png" style="width:6.5in;height:3.50972in" alt="Graphical user interface, application Description automatically generated" />
<p>Đến đây, ta thực hiện tìm column trong flag table:</p>
<ul>
<li>Payload: <em>username=uuysyy&amp;password=123&amp;email=gg'),('cgc','123',(select column_name from information_schema.columns where table_name='flag' limit 0,1))-- -</em></li>
</ul>
<img src="./media/image19.png" style="width:6.5in;height:3.40139in" alt="Graphical user interface, text Description automatically generated" />
<p>Giờ thì tìm flag:</p>
<p><em>username=sadadas&amp;password=123&amp;email=gg'),('cvb','123',(select flag from flag limit 0,1))-- -</em></p>
<img src="./media/image20.png" style="width:6.5in;height:3.20903in" alt="Graphical user interface, text, application, email Description automatically generated" />
<ul>
<li>Flag: moaZ63rVXUhlQ8tVS7Hw</li>
</ul>
<img src="./media/image21.png" style="width:6.5in;height:3.29722in" alt="Graphical user interface, text, application Description automatically generated" />
<p><strong>Flag:</strong> moaZ63rVXUhlQ8tVS7Hw</p>
<p>- Flag:</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../SQL-Injection/SQLinjection-Filterbypass/SQLinjection-Filterbypass.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../SQL-Injection/SQLinjection-Routed/SQLinjection-Routed.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../SQL-Injection/SQLinjection-Filterbypass/SQLinjection-Filterbypass.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../SQL-Injection/SQLinjection-Routed/SQLinjection-Routed.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../../mark-09e88c2c.min.js"></script>
        <script src="../../searcher-6752007c.js"></script>

        <script src="../../clipboard-1626706a.min.js"></script>
        <script src="../../highlight-abc7f01d.js"></script>
        <script src="../../book-66cfebdd.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
